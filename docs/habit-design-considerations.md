# 習慣画面・習慣モデルの検討メモ

## 1. 実施した変更（今回）

- **アーカイブ機能の削除**  
  「アーカイブを表示」リンク・各カードの「アーカイブ」ボタン・アーカイブ一覧を削除しました。不要と判断したためです。データ上の `archived` フラグは互換のため残してありますが、UI からは触れません。
- **頻度の見える化**  
  習慣カードに「毎日」「週月火水木金」「N日ごと」など、**何日に一回か**を表示するようにしました。スケジュールONのときだけ「目標 ○分 · 毎日」のように表示されます。

---

## 2. 現在の仕様の整理

### 2.1 実行頻度（何日に一回か）

| ルール | 説明 | 設定例 |
|--------|------|--------|
| **毎日 (daily)** | 毎日予定に出現 | 頻度＝毎日 |
| **週の指定曜日 (weekly)** | 選択した曜日だけ出現 | 月火水木金など |
| **N日ごと (interval_days)** | 基準日から N 日ごと | 2日ごと、7日ごとなど |

※「1ヶ月に1回」は未対応。`interval_days: 30` で近いことは可能。

### 2.2 スケジュールあり / なし

- **スケジュールON** … 予定タブに「今日のTODO」として出現。時間指定ありならタイムラインにブロック表示。
- **スケジュールOFF** … 予定には出ない。記録（ログ）は従来どおり取れる。

「スケジュール関係なく行うもの」を**単純なタスク**として扱う場合は、現状は「スケジュールOFFの習慣」がそれに近いが、「いつでも」のTODOとして予定の「時間指定なし」に出すかどうかは、スケジュールON＋時間なしで実現している。

### 2.3 タイプと目標（rep・時間）

| タイプ | 主な目標 | 記録で使う項目 |
|--------|----------|----------------|
| **運動 (exercise)** | セット×rep、または分数 | sets, reps / durationMin |
| **学習 (study)** | 分数のみ | durationMin |

- **学習に rep を付けたい**  
  例：「10ページ読んだ＝10 rep」など。現状の型は `study` に rep がないため、対応するなら  
  - 学習でも `targetReps`（＋任意で `targetSets`）を許す、または  
  - 新しいタイプ／「単位」を追加（例：`count`＝回数・ページ数など）  
  のどちらかが必要。
- **その他の項目**  
  「運動・学習以外」（読書冊数、歩数、メモ項目など）を扱うなら、  
  - タイプを増やす（例：`reading`, `other`）、  
  - または「カスタム単位」のような汎用フィールドを足す  
  などの拡張が考えられる。

### 2.4 優先度

- 習慣に `priority`（数値、小さいほど上）がある。
- 予定タブでは「時間指定あり」は時間順、「時間指定なし」はこの優先度順で表示。
- 「単純タスク」としての優先度も、現状はこの同じ `priority` で表現可能。

---

## 3. 今後の検討候補

### 3.1 単純タスク（スケジュールに紐づかないもの）

- **要件**  
  週間スケジュールではなく「やるべきタスク」として、優先度だけ付けて並べたい。
- **案**  
  - 現状の「スケジュールOFF」習慣を「タスク」として扱い、予定の「時間指定なし」エリアに優先度順で並べる（すでに可能に近い）。  
  - あるいは「種別：習慣 / タスク」を分け、タスクは「その日のリストのみ・曜日なし」と明示する。

### 3.2 実行頻度の拡張

- **月1回**  
  - `scheduleRule: "monthly"` と `scheduleDayOfMonth?: number`（1–31）を追加するなど。  
  - または `interval_days: 30` で運用し、UI で「月1回」と説明する。
- **週N回**  
  - 現状は「曜日指定」のみ。「週2回」などは「指定曜日を2つ選ぶ」で対応可能。  
  - 「週に2回、曜日は問わない」はルール追加が必要。

### 3.3 学習の rep・その他項目

- **学習で rep を付与**  
  - データ: `study` タイプに `targetReps`（と必要なら `targetSets`）を追加。  
  - UI: 習慣編集・記録フォームで「回数（rep）」を入力できるようにする。  
  - 集計: 分析で「学習の rep」をどう見せるか（ページ数・問題数など）を決める。
- **その他カテゴリ・単位**  
  - タイプを増やす（読書、歩数、その他）。  
  - または「単位」をユーザーが選ぶ／入力する（回、分、ページ、km など）にして、記録フォームとグラフをそれに合わせる。

### 3.4 習慣の「作成したあとどうするか」

- **並び順**  
  - 一覧は現状「トレンド用の並び」など。優先度順・作成日順・名前順などの選択肢があるとよい。
- **削除**  
  - アーカイブを廃止したため、「完全削除」を UI に用意するか検討の余地あり（データ整合性・ログとの関係に注意）。
- **複製**  
  - 似た習慣を楽に作る「複製」があると便利な場合あり。

---

## 4. 実装の優先度イメージ

1. **済** アーカイブ削除・頻度表示の追加  
2. **検討** 学習に rep（＋任意で sets）を追加  
3. **検討** 単純タスクの扱いの明確化（表示名・種別の整理）  
4. **検討** 月1回・週N回など頻度の拡張  
5. **検討** タイプ／単位の拡張（その他カテゴリ・カスタム単位）  
6. **検討** 習慣の削除・複製・並び順

このドキュメントは、上記を検討するためのメモです。方針が決まり次第、個別に issue 化や実装に落とすとよいです。

# プログレッシブオーバーロードを「感じ取れる」UI 案

ユーザーが数値を読まなくても、前回比・平均比を無意識に感じられる表現をまとめる。

---

## 1. 前回比 / 平均比の扱い

| 比較対象 | 目的 | 表現案 | ロジック |
|----------|------|--------|----------|
| **前回（前週）比** | 直近の変化を「量」で感じる | 2本バー（前週 vs 今週）を横並び。長さのみで比較。数値は出さない or タップで表示 | `thisSum`, `lastSum` を取得済み。表示幅を `max(thisSum, lastSum)` で正規化し、各バーの幅を比率で描画 |
| **平均比** | 日々が平均より上/下かを「位置」で感じる | 折れ線グラフに平均の水平線（破線・薄色）を1本引く。線の上下で「平均超え」を視覚化 | `series` の `value` の平均を算出。Y 軸上で `y(avg)` の位置に `<line>` を描画。凡例は出さず「基準」としてのみ |
| **前日比（オプション）** | 連続した変化を感じる | 各日を小さな丸で表示し、「前日より上」の日は丸を少し大きく | 日別値の配列で `value[i] > value[i-1]` なら circle の r を 4、そうでなければ 3 など |

**方針**: 前回比は「長さ」、平均比は「線の位置」に寄せる。数値で「+9%」と書かず、形で伝える。

---

## 2. 色・記号・余白の使い方

- **色**: 良し悪しを評価しない。増減は「同じ色の濃淡」または「アクセントの有無」で表現。
  - 例: 前週比 up → カード左端に細い縦線（neutral-400）。same → なし。down → 左端をより薄く（neutral-300）。「良い/悪い」ではなく「変化の有無・方向」だけ。
- **記号**: ↑↓→ は維持。加えて「長さ」で補足すると、数字を読まなくても「今週のバーが長い」で増加を感じられる。
- **余白**: トレンドが「up」のカードだけ左パディングを少し増やし、左端にアクセントバー用のスペースを確保。視線は左から右なので、左端のアクセントで「この指標は動いた」と無意識に気づかせる。

---

## 3. 数値を直接見せない代替案

| 案 | 説明 | 実装 |
|----|------|------|
| **A. 比較バーのみ** | KPI カードに数値なし。前週・今週の2本バー（横棒）だけ。長さの差で増減を感じる | `ComparisonBar` コンポーネント。`lastValue`, `thisValue` を渡し、max で正規化して幅で描画。2行：1行目「前週」+バー、2行目「今週」+バー。ラベルは「前週」「今週」のみ（実装済み：KPI カード内に表示、数値はオプション） |
| **B. 数値はタップで** | デフォルトはラベル + トレンドアイコン + 比較バー。タップで「275 rep」などを表示 | `KPICard` に `showValueOnTap`。初期は value を非表示、クリックで表示 |
| **C. グラフの線の太さ** | 日別グラフで、その日が平均より上なら線を太く、下なら細く。うねりで「平均超えの日」を感じる | `SimpleLineChart` で各線分の `strokeWidth` を `value[i] >= avg ? 2.5 : 1.5` などで変更（折れ線は path をセグメント分割する必要あり） |
| **D. パルス/リズム** | 7日分を円の大きさで表現。その日の値が大きいほど円が大きい。数値なしで「リズム」を感じる | 横並びの `<circle>` の r を値に比例させる。軸ラベルは日付のみ |

**推奨**: まず **前週 vs 今週の比較バー**（数値は残しつつ、視覚の主役をバーにする）と **グラフの平均線** を実装。数値非表示はオプション（ユーザー設定や「詳細を見る」で切り替え）として用意する。

---

## 4. 実装方針（ロジック）

### 4.1 データ

- **前週 / 今週**: 既存の `store.series(metric, 14)` で取得。`slice(0,7)` と `slice(-7)` で前週・今週に分割し、`reduce` で合計。→ 現状の `summarize()` で実施済み。
- **7日平均**: `store.series(metric, 7)` の `value` の平均。`sum / length`。グラフ描画時に `y(avg)` を渡す。

### 4.2 コンポーネント

- **ComparisonBar**（新規）  
  - Props: `lastValue: number`, `thisValue: number`, `label?: string`  
  - 実装: `max = Math.max(lastValue, thisValue, 1)`。左バー幅 = `(lastValue / max) * 100%`、右バー幅 = `(thisValue / max) * 100%`。左右に「前」「今」の短いラベルのみ。数値は渡さない or オプションで表示。
- **SimpleLineChart**  
  - Props に `average?: number` を追加。渡された場合、Y 軸上で `y(average)` に破線の `<line>` を描画。色は `currentColor` の 30% 程度。
- **KPICard**  
  - Props に `showComparisonBar?: boolean`, `lastValue?: number` を追加。`true` かつ `lastValue` がある場合、カード下部に `ComparisonBar` を表示。またはカード自体を「数値 + トレンド」から「比較バー + トレンド」に切り替えるモードを追加。

### 4.3 評価しない設計の維持

- 前週比 up/down で色を変えない（緑/赤禁止）。  
- 比較バーも単色（左=前週、右=今週で同じ色の濃淡、または左を薄く右を濃くで「今」を強調する程度）。  
- 平均線も「基準」であり、「超えている = 良い」とは言わない。凡例に「平均」とだけ出し、説明は控えめに。

---

## 5. まとめ

| 表現 | 役割 | 実装 |
|------|------|------|
| 前週 vs 今週の長さ | 前回比を数値なしで感じる | ComparisonBar |
| グラフの平均線 | 平均比を「線の上下」で感じる | SimpleLineChart に average 渡す |
| 左端アクセント | トレンドがある指標に視線を誘導 | KPICard の border-left または疑似要素 |
| 数値は残す | 必要なら読める。主役は形にする | 比較バーを主、数値は副に配置 |

これにより「数値を読まなくても、バーの長さとグラフの線の位置でプログレッシブオーバーロードを感じ取れる」UI を目指す。
